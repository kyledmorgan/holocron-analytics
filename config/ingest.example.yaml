# Holocron Analytics Ingestion Framework Configuration
# This is an example configuration file. Copy to config/ingest.yaml and customize.

# Storage configuration
storage:
  # File-based data lake
  data_lake:
    enabled: true
    # Override via INGEST_DATA_LAKE_DIR environment variable.
    base_dir: "W:/data_lake"
    pretty_print: true
  
  # SQL Server storage (optional)
  sql_server:
    enabled: false
    # Connection string from environment variable: INGEST_SQLSERVER_CONN_STR
    # Or use discrete variables:
    host: localhost
    port: 1434
    database: Holocron
    user: sa
    # password is read from environment (INGEST_SQLSERVER_PASSWORD or MSSQL_SA_PASSWORD)
    schema: "ingest"
    table: "IngestRecords"

# State store configuration
# The state store manages work queue, dedupe, and run tracking.
#
# SQL Server is the only supported backend.
# Set DB_BACKEND environment variable or configure below.
state:
  # Backend type: "sqlserver" (only supported option)
  type: "sqlserver"
  
  # SQL Server configuration
  sqlserver:
    # Connection from environment variables (recommended):
    # - INGEST_SQLSERVER_HOST, INGEST_SQLSERVER_PORT
    # - INGEST_SQLSERVER_DATABASE, INGEST_SQLSERVER_USER
    # - INGEST_SQLSERVER_PASSWORD (required, never commit to config)
    # 
    # Or use discrete values below:
    host: "localhost"
    port: 1434
    database: "Holocron"
    user: "sa"
    # password: (use INGEST_SQLSERVER_PASSWORD or MSSQL_SA_PASSWORD env var)
    driver: "ODBC Driver 18 for SQL Server"
    schema: "ingest"

# Runner configuration
runner:
  batch_size: 10
  max_items: null  # null = unlimited
  max_retries: 3
  enable_discovery: true
  
  # Concurrent runner settings
  # These control multi-worker parallel processing
  max_workers: 4              # Number of concurrent worker threads
  lease_seconds: 300          # How long a work item lease is valid (5 min)
  heartbeat_interval: 30      # Seconds between worker heartbeat updates
  
  # Backoff settings for throttling/error responses
  base_backoff_seconds: 2.0   # Base delay for exponential backoff
  max_backoff_seconds: 300.0  # Maximum backoff delay (5 min)
  respect_retry_after: true   # Honor Retry-After header from responses
  
  # Global rate limiting (requests per second, 0 = unlimited)
  requests_per_second: 0.0

# Source configurations
sources:
  - name: "wikipedia"
    type: "mediawiki"
    api_url: "https://en.wikipedia.org/w/api.php"
    rate_limit_delay: 1.0  # seconds between requests
    timeout: 30
    max_retries: 3
    user_agent: "HolocronAnalytics/1.0 (Educational; Local Research)"
    
    # Discovery settings
    discovery:
      enabled: true
      discover_links: true
      discover_categories: false
      max_depth: 2

  # Wookieepedia (Star Wars wiki) configuration
  - name: "wookieepedia"
    type: "mediawiki"
    api_url: "https://starwars.fandom.com/api.php"
    rate_limit_delay: 1.0  # Be polite to Fandom servers
    timeout: 30
    max_retries: 3
    user_agent: "HolocronAnalytics/1.0 (Educational; Star Wars Research)"
    
    # Discovery settings for link crawling
    discovery:
      enabled: true
      discover_links: true
      discover_categories: false
      max_depth: 3

# Seed definitions (initial work items)
seeds:
  # # Example: Fetch specific Wikipedia pages
  # - source: "wikipedia"
  #   resource_type: "page"
  #   titles:
  #     - "Star Wars"
  #     - "The Empire Strikes Back"
  #     - "Return of the Jedi"
  #   priority: 10

  # Wookieepedia seed pages for link crawling
  - source: "wookieepedia"
    resource_type: "page"
    titles:
      - "Jar Jar Binks"
      - "Rogue One"
      - "Dark Forces"
      - "Mandalorian"
      - "Ahsoka Tano
      - "The Child (Star Wars)
      - "Thrawn (Star Wars character)
      - "Bo-Katan Kryze"
      - "Grand Admiral Thrawn"
      - "Darth Vader"
      - "Luke Skywalker"
      - "Princess Leia"
      - "Han Solo"
      - "Obi-Wan Kenobi"
      - "Yoda"
      - "Emperor Palpatine"
      - "Chewbacca"
      - "C-3PO"
      - "R2-D2"
      - "Boba Fett"
      - "Lando Calrissian"
      - "Darth Maul"
      - "Qui-Gon Jinn"
      - "Mace Windu"
      - "Count Dooku"
      - "General Grievous"
      - "Kylo Ren"
      - "Rey"
      - "Finn"
      - "Poe Dameron"
      - "Captain Phasma"
      - "Supreme Leader Snoke"
      - "Darth Sidious"
    priority: 10

