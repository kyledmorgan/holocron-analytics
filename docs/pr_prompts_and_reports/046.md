# PR #46: Add Functional Gap Analysis for LLM expansion pipeline

## Header

| Field | Value |
|---|---|
| **PR Number** | 46 |
| **Title** | Add Functional Gap Analysis for LLM expansion pipeline |
| **URL** | https://github.com/kyledmorgan/holocron-analytics/pull/46 |
| **State** | merged |
| **Created** | 2026-02-12T20:37:39Z |
| **Updated** | 2026-02-13T00:18:28Z |
| **Merged** | 2026-02-13T00:18:28Z |
| **Base branch** | `working_20260115` |
| **Head branch** | `copilot/current-state-inventory-analysis` |
| **Merge commit SHA** | `067562af8670c0a41d4dfd6c8008816ccc489437` |

---

## PR Body

Analyzed current system against requirements for LLM-driven multi-entity extraction with relationship modeling. Created comprehensive documentation to inform Phase 0-3 implementation.

## Documentation Structure

Six markdown files in `docs/fga/` (3,700+ lines, 8 Mermaid diagrams):

- **01-current-state-inventory.md** â€” SQL artifacts (40+ tables across 5 schemas), Python modules (30+ runners/stores/contracts), storage patterns (lake + DB)
- **02-data-model-map.md** â€” 5 ERD diagrams, missing bridges (entity-entity, entity-event, entity-work), subtype patterns
- **03-workflow-and-runner-map.md** â€” Queue lifecycles (ingest, llm, vector), concurrency patterns (lease-based, READPAST), recovery scenarios
- **04-functional-gap-analysis.md** â€” 9 capability gaps with impact/effort/dependencies: multi-entity extraction, stored proc routing, identity resolution, chunking pipeline
- **05-recommendations-and-next-steps.md** â€” Phased roadmap (Phase 0: scaffolding, Phase 1: single entity type E2E, Phase 2: relationships, Phase 3: backfill), decision points with recommendations
- **README.md** â€” Navigation guide

## Key Findings

**Current state:**
- Mature work queue (atomic claiming via stored procs, exponential backoff, lease management)
- Page classification operational (rules + LLM hybrid, semantic staging)
- Vector schema scaffolded but chunking pipeline stub-only

**Critical gaps:**
- No multi-entity extraction from single source (currently 1:1 pageâ†’entity)
- No stored procedures accepting JSON payloads for multi-table routing
- No entity identity resolution or deduplication logic
- No bridge table population (entity relationships, events, works)

**Recommended approach:**
Start with Phase 1 (single entity subtype E2E: Droids) to validate contractâ†’extractionâ†’stored procâ†’insertion flow before generalizing.

## Example Contract (Proposed)

```json
{
  "entities": [
    {
      "name": "R2-D2",
      "type": "Droid",
      "confidence": 1.0,
      "attributes": {"model": "astromech", "owner": "Luke Skywalker"}
    }
  ],
  "relationships": [
    {
      "from_entity": "R2-D2",
      "to_entity": "Luke Skywalker",
      "relation_type": "owned_by",
      "confidence": 0.95
    }
  ]
}
```

Routed via `dbo.usp_process_combined_extraction_output` for transactional multi-table writes.

<!-- START COPILOT CODING AGENT TIPS -->
---

ðŸ’¬ We'd love your input! Share your thoughts on Copilot coding agent in our [2 minute survey](https://gh.io/copilot-coding-agent-survey).

---

## Comments

_No comments._

---

## Review Comments (inline diff)

_No inline review comments._

---

## Copilot Artifacts

_No Copilot artifact indicators detected._
