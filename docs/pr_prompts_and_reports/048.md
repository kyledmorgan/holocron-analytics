# PR #48: Implement Phase 0 scaffolding for LLM job types

## Header

| Field | Value |
|---|---|
| **PR Number** | 48 |
| **Title** | Implement Phase 0 scaffolding for LLM job types |
| **URL** | https://github.com/kyledmorgan/holocron-analytics/pull/48 |
| **State** | merged |
| **Created** | 2026-02-13T03:52:17Z |
| **Updated** | 2026-02-13T04:08:35Z |
| **Merged** | 2026-02-13T04:08:35Z |
| **Base branch** | `working_20260115` |
| **Head branch** | `copilot/implement-minimal-scaffolding` |
| **Merge commit SHA** | `3066e13b099cb7394864b9ef2d7ee911e8abbbd9` |

---

## PR Body

Establishes minimal infrastructure for introducing new LLM job types with consistent routing, correlation, dry-run mode, and idempotency—foundation for Phase 1+ extraction pipelines.

### Job Type Registry (`src/llm/jobs/`)
- `JobTypeDefinition` dataclass with job_type, interrogation_key, handler_ref, operational metadata
- `JobTypeRegistry` with lazy-loaded built-ins (`page_classification`, `sw_entity_facts`)

### Dispatcher (`src/llm/runners/dispatcher.py`)
- Routes jobs to handlers via registry lookup
- Builds `RunContext` with correlation IDs flowing through execution
- CLI: `--once`, `--loop`, `--dry-run`, `--list-types`

### Correlation + Structured Logging
- `StructuredFormatter` for JSON logs with job_id/run_id/correlation_id
- `RunContext.get_log_context()` for consistent log fields

### Dry-Run Mode
- `ExecutionMode.DRY_RUN` skips LLM calls and domain writes
- Writes all artifacts to lake for prompt/contract iteration

### Job Idempotency (`db/migrations/0025_llm_job_idempotency.sql`)
- `dedupe_key` column on `llm.job` with unique constraint on `(interrogation_key, dedupe_key)`
- `SqlJobQueue.enqueue_job_idempotent()` returns existing job if duplicate

```bash
# List registered job types
python -m src.llm.runners.dispatcher --list-types

# Dry-run single job
python -m src.llm.runners.dispatcher --once --dry-run
```

### Tests
49 new unit tests across `test_job_type_registry.py`, `test_job_handlers.py`, `test_dispatcher.py`.

<!-- START COPILOT CODING AGENT TIPS -->
---

✨ Let Copilot coding agent [set things up for you](https://github.com/kyledmorgan/holocron-analytics/issues/new?title=✨+Set+up+Copilot+instructions&body=Configure%20instructions%20for%20this%20repository%20as%20documented%20in%20%5BBest%20practices%20for%20Copilot%20coding%20agent%20in%20your%20repository%5D%28https://gh.io/copilot-coding-agent-tips%29%2E%0A%0A%3COnboard%20this%20repo%3E&assignees=copilot) — coding agent works faster and does higher quality work when set up for your repo.

---

## Comments

_No comments._

---

## Review Comments (inline diff)

_No inline review comments._

---

## Copilot Artifacts

_No Copilot artifact indicators detected._
