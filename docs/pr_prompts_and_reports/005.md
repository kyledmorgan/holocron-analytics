# PR #5: Build learner-facing SQL views and progressive exercises

## Header

| Field | Value |
|---|---|
| **PR Number** | 5 |
| **Title** | Build learner-facing SQL views and progressive exercises |
| **URL** | https://github.com/kyledmorgan/holocron-analytics/pull/5 |
| **State** | merged |
| **Created** | 2026-01-17T06:21:06Z |
| **Updated** | 2026-01-17T06:51:41Z |
| **Merged** | 2026-01-17T06:51:40Z |
| **Base branch** | `working_20260115` |
| **Head branch** | `copilot/create-sql-learner-views` |
| **Merge commit SHA** | `a8b71c1efcf8357d885baa5edf1c815152782898` |

---

## PR Body

Creates a 3-tier view architecture that abstracts warehouse schema (Dim/Fact/Bridge tables) from SQL learners, plus 10 progressive lesson modules with exercises and answer keys.

## Views

**`sem_*` Semantic Layer (16 views)**
- Canonical query surface flattening core relationships
- `sem_franchise`, `sem_work`, `sem_scene`, `sem_character`, `sem_species`, `sem_organization`, `sem_location`, `sem_event`, `sem_event_participant`, `sem_event_asset`, `sem_tech_asset`, `sem_tech_instance`, `sem_appearance_look`, `sem_continuity_frame`, `sem_continuity_issue`, `sem_claim`, `sem_issue_claim_link`

**`mart_*` Story Marts (10 views)**
- Pre-joined views for common analyses
- Deep dive marts (`mart_trench_run_events`, `mart_duel_of_fates_events`) pre-filtered to scene ranges

**`learn_*` Training Views (8 views)**
- Flat, join-free "tables" for learners
- `learn_characters`, `learn_scenes`, `learn_events`, `learn_event_participants`, `learn_assets`, `learn_locations`, `learn_continuity_issues`, `learn_claims`

## Lessons

10 modules progressing from basic SELECT to sequence analysis:

| Module | Skills |
|--------|--------|
| 01 Character Directory | SELECT, WHERE, ORDER BY, LIKE |
| 02-03 Appearances/Timeline | JOINs, BETWEEN |
| 04-05 Interactions/Assets | GROUP BY, HAVING, COUNT |
| 06-07 Locations/Scenes | Hierarchies, aggregation |
| 08 Continuity Issues | Complex filtering |
| 09-10 Deep Dives | Narrative sequence queries |

Each module has paired `_exercises.sql` and `_answers.sql` files. Answers include inline variations:

```sql
WHERE Species = 'Human'           -- Filter for humans only
/* VARIATIONS:
   - AND Gender = 'Female'        -- Add gender filter
   - AND RoleArchetype = 'Hero'   -- Only human heroes
*/
```

## Notes
- Learner materials never reference physical table names
- Views filter `IsActive=1 AND IsLatest=1`
- STRING_AGG usage notes SQL Server 2017+ requirement

<!-- START COPILOT CODING AGENT SUFFIX -->



<!-- START COPILOT ORIGINAL PROMPT -->



<details>

<summary>Original prompt</summary>

# TASK: Build learner-facing SQL ‚Äútables‚Äù (views) + progressive exercises + answer keys

## Goal
Create a progressive SQL learning surface over our existing warehouse-style schema (Dims/Facts/Bridges exist but MUST NOT be exposed to learners). We will implement a layered set of SQL Server views using industry-normal conventions, then create lessons/exercises that query ONLY the learner-facing objects.

This work is **data-modeling and teaching-focused**:
- Create the views (semantic layer ‚Üí marts/story layer ‚Üí learning layer).
- Create paired exercise files + answer-key files for the top story use cases.
- Ensure lineage exists (views on views as needed), but **the learner never sees the underlying physical tables**.

## Constraints (must follow)
1. **Do not mention** Dim*/Fact*/Bridge* tables in learner materials (exercises).  
2. Learner materials should treat learner-facing objects as ‚Äútables‚Äù conceptually. Avoid explaining ‚Äúthese are views.‚Äù
3. Only the answer keys may include deeper commentary. Even there, do NOT name the underlying physical tables unless unavoidable. Prefer to keep everything expressed via `sem_` and `mart_`.
4. Follow naming conventions:
   - `sem_*` = semantic foundation views (canonical query surface)
   - `mart_*` = story- and analysis-specific marts
   - `learn_*` = simplified learning ‚Äútables‚Äù (views) with minimal joins
5. Views can depend on other views (lineage is required). Maintain a clean dependency chain:
   - base physical tables ‚Üí `sem_*` ‚Üí `mart_*` ‚Üí `learn_*`
6. All SQL must be **SQL Server** compatible.
7. No new stored procedures or functions in this phase (views only, plus .sql exercise scripts).
8. Do not change existing DDL or seed JSON in this phase unless strictly required to make views compile.
9. You may update existing documentation(broad, or group) as needed, but the focus is to create a lesson runbook for our learner to get hands on with the data.  


## Inputs to mine (read before writing)
- All DB DDL scripts (current schema)
- All seed JSON files + ingestion docs
- Any README / docs describing conventions, ‚Äúspine,‚Äù events, continuity, etc.
Use these to pick canonical columns, join keys, and story-driven slices.

## Deliverables (create these files)
Create a folder structure under the repo (adjust if it already exists):
- `src/db/views/sem/`
- `src/db/views/mart/`
- `src/db/views/learn/`
- `src/db/lessons/` (or `docs/lessons/` if that‚Äôs where docs live)

For each view, create one `.sql` file with:
- `CREATE OR ALTER VIEW ... AS`
- A header comment block describing intent, audience, and key columns
- Use deterministic column ordering
- Avoid `SELECT *`

For lessons:
- For each story module, create two sister SQL files:
  - `src/db/lessons/<NN>_<module>_exercises.sql`
  - `src/db/lessons/<NN>_<module>_answers.sql`
- Exercises file contains:
  - A short module introduction
  - A sequence of exercises, numbered
  - Each exercise includes: goal, hints, and the list of allowed ‚Äútables‚Äù (views)
  - Exercises should not include full solution queries
- Answers file contains:
  - Matching exercise numbers
  - Full solution query for each
  - **Aggressive inline comments** explaining important lines
  - 3‚Äì6 optional variations per exercise as commented-out lines:
    - Use block-style inline comment toggles on the same line, e.g.:
      `AND e.EventTypeName = 'Injury' /* try: 'Death','ForceUse','Repair' */`
    - Or use commented predicates:
      `-- AND e.ConfidenceScore >= 0.80  /* tighten confidence */`
  - Keep optional variations present but not noisy; prefer quality over quantity.

## Progressive learning design (important)
Difficulty must increase across modules and within each module:
- Start with simple `SELECT`, `WHERE`, `ORDER BY`, `TOP`, `DISTINCT`
- Then `JOIN` (but only against `learn_*` objects)
- Then grouping (`COUNT`, `MIN/MAX`, `GROUP BY`)
- Then window functions (optional, later modules only)
- Then ‚Äúnarrative‚Äù analysis (timelines, sequences, continuity fork detection) using curated marts

Learners should repeat patterns frequently (‚Äúreps‚Äù), but with varied story contexts.

## Top ‚Äústory modules‚Äù to implement (minimum 10)
Implement at least these 10 modules with corresponding view support:

1. **Character directory & profiles**
   - browse characters, species, affiliations (simple filters)
2. **Where/when a character appears**
   - appearances by work/scene/time anchor
3. **Event timeline explorer**
   - chronological list of events by work/scene with types and confidence
4. **Who met whom (co-occurrence / interactions)**
   - participants in same events; role-based filtering
5. **Asset lifecycle**
   - when an asset (ship/weapon/droid) was used/damaged/destroyed
6. **Location hierarchy explorer**
   - galaxy ‚Üí region ‚Üí system ‚Üí planet ‚Üí site; where events occur
7. **Scene breakdown dashboards**
   - scene duration proxies (start/end sec) and event density
8. **Continuity issues & claim clusters**
   - issues by severity, dispute level; linke...

</details>



<!-- START COPILOT CODING AGENT TIPS -->
---

üí° You can make Copilot smarter by setting up custom instructions, customizing its development environment and configuring Model Context Protocol (MCP) servers. Learn more [Copilot coding agent tips](https://gh.io/copilot-coding-agent-tips) in the docs.

---

## Comments

_No comments._

---

## Review Comments (inline diff)

_No inline review comments._

---

## Copilot Artifacts

_No Copilot artifact indicators detected._
