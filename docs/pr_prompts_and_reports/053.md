# PR #53: SQL-Only Schema Standardization (Core Commit)

## Header

| Field | Value |
|---|---|
| **PR Number** | 53 |
| **Title** | SQL-Only Schema Standardization (Core Commit) |
| **URL** | https://github.com/kyledmorgan/holocron-analytics/pull/53 |
| **State** | merged |
| **Created** | 2026-02-14T05:26:55Z |
| **Updated** | 2026-02-14T05:52:45Z |
| **Merged** | 2026-02-14T05:52:45Z |
| **Base branch** | `working_20260115` |
| **Head branch** | `copilot/standardize-sql-core-schema` |
| **Merge commit SHA** | `2e5b3eec7cc88334c02e663ba3996914cf599580` |

---

## PR Body

Standardizes the database schema naming conventions, key patterns, and datetime handling. Establishes anti-drift documentation to prevent future inconsistencies.

## Key Changes

### Naming Convention Fixes
- `...Id` → `...Key` / `...Guid` / `...ExtKey` throughout DDL
- `NEWSEQUENTIALID()` → `NEWID()` for all public GUIDs (security: prevents row count inference)
- `IngestBatchId` → `IngestBatchKey` across all tables
- `ExternalId` → `ExternalExtKey` in DimEntity

### Schema Reorganization
- `dbo.sem_*` views → `sem.vw_*` (17 views moved)
- `DimEvent` → `DimOccurrence` (avoids semantic collision with `FactEvent`)

### Migration Scripts
- `0030_schema_standardization_preflight.sql` — Row count inventory + analysis queries
- `0031_schema_standardization.sql` — Idempotent migration with data preservation

### Anti-Drift Documentation
- `docs/agent/db_policies.md` — Canonical naming rules
- `docs/agent/db_templates.md` — Copy-paste templates for new tables/views
- `docs/agent/db_review_checklist.md` — PR review checklist
- `docs/db/schema_refactor_report.md` — Breaking changes mapping for Python reconciliation

## Example: Before/After

```sql
-- Before
EntityGuid UNIQUEIDENTIFIER DEFAULT (NEWSEQUENTIALID())
ExternalId NVARCHAR(200) NULL
CREATE VIEW dbo.sem_character AS ...

-- After  
EntityGuid UNIQUEIDENTIFIER DEFAULT (NEWID())
ExternalExtKey NVARCHAR(200) NULL
CREATE VIEW sem.vw_character AS ...
```

## Scope

**This PR:** SQL DDL + migrations only  
**Next PR:** Python code reconciliation (column/view name updates)

<!-- START COPILOT CODING AGENT TIPS -->
---

✨ Let Copilot coding agent [set things up for you](https://github.com/kyledmorgan/holocron-analytics/issues/new?title=✨+Set+up+Copilot+instructions&body=Configure%20instructions%20for%20this%20repository%20as%20documented%20in%20%5BBest%20practices%20for%20Copilot%20coding%20agent%20in%20your%20repository%5D%28https://gh.io/copilot-coding-agent-tips%29%2E%0A%0A%3COnboard%20this%20repo%3E&assignees=copilot) — coding agent works faster and does higher quality work when set up for your repo.

---

## Comments

_No comments._

---

## Review Comments (inline diff)

_No inline review comments._

---

## Copilot Artifacts

_No Copilot artifact indicators detected._
