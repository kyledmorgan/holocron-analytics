# PR #2: Add Docker Desktop local dev environment with SQL Server and seed runner

## Header

| Field | Value |
|---|---|
| **PR Number** | 2 |
| **Title** | Add Docker Desktop local dev environment with SQL Server and seed runner |
| **URL** | https://github.com/kyledmorgan/holocron-analytics/pull/2 |
| **State** | merged |
| **Created** | 2026-01-17T05:07:41Z |
| **Updated** | 2026-01-17T05:22:21Z |
| **Merged** | 2026-01-17T05:22:20Z |
| **Base branch** | `working_20260115` |
| **Head branch** | `copilot/add-docker-dev-environment` |
| **Merge commit SHA** | `d3d55ba14ce7480a797ae8a8e47efa1b20f066c1` |

---

## PR Body

Enables one-command local development: `docker compose up --build` starts SQL Server 2022 Developer Edition, creates the database, runs DDL scripts, and loads seed data. Only Docker Desktop required.

### New Files

- **`docker-compose.yml`** ‚Äî Three services:
  - `sqlserver`: SQL Server 2022 with persistent volume, healthcheck on port 1433
  - `initdb`: Creates database + runs DDL scripts (dimensions ‚Üí facts ‚Üí bridges)
  - `seed`: Builds Python container, runs `seed_loader.py --all` after initdb completes

- **`docker/Dockerfile.seed`** ‚Äî Python 3.11 slim with ODBC Driver 18 for SQL Server

- **`docker/init-db.sql`** ‚Äî Idempotent database creation via sqlcmd variables

- **`docs/runbooks/docker_local_dev.md`** ‚Äî Full runbook: prerequisites, quick start, connection info, troubleshooting

### Modified Files

- **`.env.example`** ‚Äî Added `MSSQL_SA_PASSWORD`, `MSSQL_DATABASE`, `SEED_SKIP` with clear Docker vs native sections

- **`README.md`** ‚Äî Added Quick Start with Docker section linking to runbook

### Usage

```bash
cp .env.example .env  # Set MSSQL_SA_PASSWORD
docker compose up --build
```

Connect via SSMS/Azure Data Studio: `localhost,1433` | `sa` | your password

Reset everything: `docker compose down -v`

<!-- START COPILOT CODING AGENT SUFFIX -->



<!-- START COPILOT ORIGINAL PROMPT -->



<details>

<summary>Original prompt</summary>

You are GitHub Copilot Agent Mode. Create a Docker Desktop-friendly local dev environment for this repo that runs:

1) SQL Server (free Developer edition container)
2) A Python ‚Äúseed runner‚Äù container that can execute our seed loader against SQL Server

Primary UX goal:
- A user with ONLY Docker Desktop installed on Windows can clone the repo, open it in VS Code, and run ONE command (preferably `docker compose up --build`) to:
  - pull the official SQL Server image
  - start SQL Server with persisted data volume
  - build the Python container
  - run the seed loader (truncate + reseed) automatically
  - leave SQL Server running for interactive use afterward

If true ‚Äúone-click import into Docker Desktop‚Äù is not feasible, provide the closest equivalent:
- `docker-compose.yml` (Compose V2)
- a `.env.example`
- a `README` runbook with exact clicks + commands
- optional helper scripts (PowerShell) that call Docker in a simple way

DELIVERABLES (FILES TO CREATE/UPDATE)

A) Docker Compose
- Add `docker-compose.yml` at repo root (or `infra/docker-compose.yml`, but root is preferred for Docker Desktop).
- Services:
  1) `sqlserver`
     - Use official Microsoft SQL Server Linux image for Developer edition (public).
     - Expose port `1433:1433`
     - Persist `/var/opt/mssql` to a named volume `mssql_data`
     - Required env:
       - `ACCEPT_EULA=Y`
       - `MSSQL_PID=Developer`
       - `MSSQL_SA_PASSWORD` (read from `.env`, do not hardcode)
     - Healthcheck: use `sqlcmd` inside container to verify it is ready.
  2) `seed`
     - Build from a Dockerfile in repo (see below).
     - Depends on `sqlserver` with condition `service_healthy`
     - Runs the seed loader once, then exits successfully.
     - Must be able to resolve SQL Server by hostname `sqlserver` (Compose network).
     - Should read the same `.env` and construct `SEED_SQLSERVER_CONN_STR` or equivalent.
     - This container should mount the repo (read-only is fine) or bake code in image.
     - Should default to: `python src/ingest/seed_loader.py --all`
     - Provide an option to skip reseed by env var (e.g., `SEED_SKIP=true`).
  3) Optional: `python-dev` (interactive)
     - A long-running Python container to let users exec into it and run scripts repeatedly.
     - Not required, but nice-to-have.

B) Dockerfiles
- Create `Dockerfile` (or `docker/Dockerfile.seed`) that:
  - Uses a slim Python base image.
  - Copies in only what is needed (src + requirements).
  - Installs dependencies for `pyodbc`:
    - unixODBC + MS ODBC Driver 18 for SQL Server (Linux)
  - Installs Python requirements (use existing requirements file; if missing, create one from what we currently use).
  - Sets default entrypoint/command to run seed loader.

C) Environment + Runbook
- Create `.env.example` with:
  - `MSSQL_SA_PASSWORD=YourStrong!Passw0rd`
  - `MSSQL_DATABASE=StarWarsDW` (or whatever our loader expects; if loader creates db, document; if not, add an init step)
  - `SEED_SKIP=false`
  - Any other required seed vars
- Update root `README.md` (or create `docs/runbook_docker.md` and link it) with:
  - ‚ÄúPrereqs: Docker Desktop only‚Äù
  - Step-by-step for Windows Docker Desktop:
    1) Ensure ‚ÄúUse WSL 2 based engine‚Äù enabled (mention Settings location)
    2) Copy `.env.example` -> `.env` and set SA password
    3) Run: `docker compose up --build`
    4) Confirm seed completed (expected log lines)
    5) SQL Server remains running; connect using SSMS/Azure Data Studio:
       - Server: `localhost,1433`
       - User: `sa`
       - Password: (from .env)
  - How to stop/reset:
    - stop: `docker compose down`
    - full reset including data: `docker compose down -v`
  - Troubleshooting:
    - password complexity failures
    - port 1433 already in use
    - seed container exits before SQL is ready (healthcheck)
    - how to view logs in Docker Desktop UI

D) Optional SQL init
We need to decide how the database itself is created.
- If our loader assumes the DB already exists:
  - Add a lightweight init step that creates the DB if missing.
  - Options:
    1) Add an `init` service that runs `sqlcmd` to create DB and exits; seed depends on it.
    2) Enhance seed loader to create DB if missing (prefer not to change loader now unless minimal).
- Implement the simplest approach:
  - Add `initdb` service that runs once after SQL is healthy:
    - `CREATE DATABASE [$(MSSQL_DATABASE)]` if not exists
  - Or bake a SQL script `src/db/init/001_create_database.sql` and run it via sqlcmd in `initdb`.

E) Make it ‚ÄúDocker Desktop importable‚Äù
Docker Desktop can open a folder with a compose file. Provide a short instruction:
- ‚ÄúOpen Docker Desktop ‚Üí Containers ‚Üí Create ‚Üí Select ‚ÄòCompose‚Äô (or open folder)‚Äù
But still ensure CLI path works.

QUALITY / SAFETY REQUIREMENTS
- Do not commit real passwords.
- Use `.env` for secrets and ensure `.env` is in `.gitignore` (if not already).
- Keep ports explicit.
- Use stable images/tags where possible.
- Ensure the seed service is idempotent ...

</details>



<!-- START COPILOT CODING AGENT TIPS -->
---

üí¨ We'd love your input! Share your thoughts on Copilot coding agent in our [2 minute survey](https://gh.io/copilot-coding-agent-survey).

---

## Comments

_No comments._

---

## Review Comments (inline diff)

_No inline review comments._

---

## Copilot Artifacts

_No Copilot artifact indicators detected._
