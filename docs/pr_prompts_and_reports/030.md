# PR #30: Remove SQLite backend - SQL Server only

## Header

| Field | Value |
|---|---|
| **PR Number** | 30 |
| **Title** | Remove SQLite backend - SQL Server only |
| **URL** | https://github.com/kyledmorgan/holocron-analytics/pull/30 |
| **State** | merged |
| **Created** | 2026-02-04T05:45:29Z |
| **Updated** | 2026-02-04T06:53:35Z |
| **Merged** | 2026-02-04T06:53:35Z |
| **Base branch** | `working_20260115` |
| **Head branch** | `copilot/remove-sqlite-references` |
| **Merge commit SHA** | `0dd160683cbb97ff06697672d7f90be140b22316` |

---

## PR Body

## Breaking Change

SQLite backend removed. SQL Server is now the only supported state store backend.

## Removed

**Core modules:**
- `src/ingest/state/sqlite_store.py` (355 lines)
- `scripts/mark_openalex_failed.py` - SQLite admin script
- `scripts/reset_wookieepedia_pending.py` - SQLite admin script
- `docs/deprecated/sqlite-state-store.md` (18KB)

**Backend selection:**
- `db_path` parameter from `create_state_store()`
- `backend="sqlite"` option from factory and CLI tools
- SQLite config sections from all YAML examples
- SQLite tests from validation suite

## Added

**SQL Server replacement stub:**
- `scripts/sqlserver_state_admin.py` - Documents removed functionality with SQL Server equivalent queries and implementation plan

**Error handling:**
```python
# Now raises ValueError with migration guidance
create_state_store(backend="sqlite")
# ValueError: SQLite backend has been removed. Only 'sqlserver' backend is supported.

create_state_store(db_path="state.db")  
# ValueError: SQLite backend has been removed. The 'db_path' parameter is no longer supported.
```

## Updated

- **Configs:** `.env.example`, `config/*.yaml`, `.vscode/settings.json` - SQL Server only
- **Docs:** 11 files updated - architecture diagrams, quickstarts, runbooks
- **Default config:** `config_loader.py` now defaults to SQL Server backend

## Migration

1. Start SQL Server: `docker compose up -d sqlserver`
2. Configure environment: `DB_BACKEND=sqlserver`, `INGEST_SQLSERVER_*` vars
3. Migrate existing SQLite data manually (export/import)

## Verification

- `git grep -i sqlite`: 10 references (all in stub docs or error messages)
- No `.db`/`.sqlite*` files remain
- Imports require SQL Server backend

**Impact:** ~1,200 lines removed, ~350 lines added

<!-- START COPILOT CODING AGENT SUFFIX -->



<!-- START COPILOT ORIGINAL PROMPT -->



<details>

<summary>Original prompt</summary>

> [!IMPORTANT]
> **Copilot Agent Prompt â€” Deprecate & Hard-Remove SQLite (Breaking Change Allowed) / SQL Server-First Re-architecture Plan**
>
> ## Objective (non-negotiable)
> We are initiating a **deprecation change** that may introduce **breaking changes**. That is acceptable.
>
> **Hard requirement:** **Remove ALL SQLite references and artifacts across the entire repository.**  
> After this PR, the repo must have **zero** SQLite usage: no code paths, no libraries, no configs, no docs implying SQLite is supported, and no tests referencing SQLite.
>
> We have migrated to **SQL Server** and ultimately target **SQL Server 2025** running in **Docker**.  
> If you can replace SQLite implementations with SQL Server equivalents safely, do it.  
> If not, **delete the SQLite implementation anyway** and leave a **non-functional comment block** that documents:
> - what the SQLite functionality used to do
> - a concrete **SQL Server replacement game plan** (connection approach, schema expectations, migration notes)
>
> ## Scope
> 1) **Code removal**
> - Search and remove all references to SQLite / sqlite3, including but not limited to:
>   - `sqlite`, `sqlite3`, `aiosqlite`, `pysqlite`, `SQLAlchemy sqlite dialect`, `*.db`, `*.sqlite`, `*.sqlite3`
>   - "SQLite" in docs, comments, READMEs, diagrams, examples
>   - connection strings referencing SQLite (`sqlite:///`, `file:...`, etc.)
> - Delete any SQLite-specific modules/classes/functions (state stores, adapters, repositories, migrations, helpers).
> - Remove SQLite dependency entries from:
>   - `requirements.txt`, `pyproject.toml`, `poetry.lock`, `package.json`, etc. (whatever applies here)
> - Remove scripts or tooling that create/manage SQLite files.
>
> 2) **Configurations & environment**
> - Remove SQLite-related environment variables and defaults.
> - Remove any config switches that allow selecting SQLite as a backend.
> - Replace with SQL Server placeholders where appropriate:
>   - e.g., `DB_PROVIDER=sqlserver` (or remove provider switching entirely and make SQL Server the only path).
>
> 3) **Tests and CI**
> - Remove any unit/integration tests that rely on SQLite.
> - Update test scaffolding to not import or reference SQLite.
> - It is acceptable if some tests are temporarily removed or disabled due to the breaking change; document it in the PR.
>
> 4) **Docs**
> - Update all docs to state SQL Server is the supported datastore.
> - If there are â€œhow to run locallyâ€ instructions, ensure they point to SQL Server (Docker) direction.
> - Remove any docs that instruct creating SQLite DBs or local file-based state.
>
> ## SQL Server replacement guidance (optional but preferred)
> Where feasible, implement SQL Server replacements for removed SQLite functionality. Keep it minimal and aligned with our direction:
> - Use a clear SQL Server connection abstraction and configuration pattern.
> - Prefer a single canonical configuration entrypoint, e.g.:
>   - `DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASSWORD`
>   - or a single `SQLSERVER_CONNECTION_STRING`
> - Keep the SQL Server implementation â€œgood enoughâ€ to compile/import cleanly, even if not fully wired to all workflows.
>
> **But again:** if a replacement will take too long or is uncertain, remove SQLite anyway and leave a `TODO` / comment plan.
>
> ## Required â€œnon-functional comment blocksâ€ (when you delete logic without replacing)
> For each deleted SQLite implementation that used to provide meaningful capability, leave a comment block at the call site or in a new placeholder module named clearly (e.g., `sqlserver_state_store_stub.py`) that includes:
> - **What it did in SQLite terms** (tables, operations, usage)
> - **How it should work in SQL Server** (tables, stored procs or schema, transaction semantics)
> - **How it will be configured** (env vars, Docker compose service name)
> - **Open questions / next PR work** (explicit checklist)
>
> These comment blocks should be concise but actionable (engineer-readable).
>
> ## Mechanical steps (do these in order)
> 1) Run a repo-wide search for:
>    - `sqlite`, `sqlite3`, `SQLite`, `.db`, `.sqlite`, `.sqlite3`, `aiosqlite`, `pysqlite`, `sqlite:///`
> 2) Remove modules and dependencies.
> 3) Update imports and adjust code so the repo still builds/loads where possible.
> 4) Replace â€œprovider switchingâ€ logic with SQL Server-only direction (or remove entirely).
> 5) Update docs.
> 6) Ensure no residual SQLite strings remain anywhere in repo (including comments) except in a single deprecation note if needed.
>
> ## Deliverables
> - A single PR that:
>   - [ ] Removes all SQLite code, dependencies, configs, docs, tests.
>   - [ ] Leaves SQL Server stubs / game-plan comments where replacement work is deferred.
>   - [ ] Updates README / developer docs to SQL Server-first.
>   - [ ] Includes a â€œBREAKING CHANGEâ€ note in PR description summarizing what was removed.
>
> ## Acceptance criteria (must pass)
> - `git grep -i sqlite` returns **no matches** (or only ...

</details>



<!-- START COPILOT CODING AGENT TIPS -->
---

ðŸ’¬ We'd love your input! Share your thoughts on Copilot coding agent in our [2 minute survey](https://gh.io/copilot-coding-agent-survey).

---

## Comments

_No comments._

---

## Review Comments (inline diff)

_No inline review comments._

---

## Copilot Artifacts

_No Copilot artifact indicators detected._
