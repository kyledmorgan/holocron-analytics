# PR #31: Refactor Python ingestion to SQL Server 2025 on port 1434

## Header

| Field | Value |
|---|---|
| **PR Number** | 31 |
| **Title** | Refactor Python ingestion to SQL Server 2025 on port 1434 |
| **URL** | https://github.com/kyledmorgan/holocron-analytics/pull/31 |
| **State** | merged |
| **Created** | 2026-02-04T07:01:01Z |
| **Updated** | 2026-02-04T07:29:17Z |
| **Merged** | 2026-02-04T07:29:17Z |
| **Base branch** | `working_20260115` |
| **Head branch** | `copilot/refactor-python-ingestion-sqlserver` |
| **Merge commit SHA** | `86e3060de964fad81badcb91d8e3dffdec28778a` |

---

## PR Body

SQLite was removed in a prior PR. This rewires all Python ingestion/crawlers to SQL Server 2025 in Docker with non-default host port 1434. Also fixes incorrect database name (`HolocronAnalytics` â†’ `Holocron`).

### Changes

**Port 1433 â†’ 1434 (host port)**
- All Python modules with SQL Server connections
- Config files (`.env.example`, YAML configs)
- `docker-compose.yml` port mapping: `1434:1433`
- Documentation

**SQL Server 2022 â†’ 2025**
- `docker-compose.yml`: `mcr.microsoft.com/mssql/server:2025-latest`

**Database name fix**
- `HolocronAnalytics` â†’ `Holocron` in all defaults and examples

### Connection defaults after this PR

```python
# src/ingest/state/__init__.py
def create_state_store(
    host: str = "localhost",
    port: int = 1434,  # was 1433
    database: str = "Holocron",
    ...
)
```

```bash
# .env.example
INGEST_SQLSERVER_PORT=1434
SEED_SQLSERVER_PORT=1434
```

### Canonical config

| Setting | Value |
|---------|-------|
| Host | `localhost` |
| Host Port | `1434` |
| Database | `Holocron` |
| Schemas | `ingest`, `llm`, `dbo` |
| Container | `holocron-sqlserver` |

<!-- START COPILOT CODING AGENT SUFFIX -->



<!-- START COPILOT ORIGINAL PROMPT -->



<details>

<summary>Original prompt</summary>

> [!IMPORTANT]
> **Copilot Agent Prompt â€” Refactor Python ingestion/crawlers to SQL Server 2025 (Docker, host port 1434) after SQLite removal**
>
> ## Context / Goal
> We recently merged a breaking-change PR that **hard-removed SQLite** support from this repo. As a follow-up, we need to **rewire all Python runners/crawlers/ingestion jobs** (OpenAlex, Wikipedia, and any other sources) to use **SQL Server 2025 in Docker** as the only datastore.
>
> We now have SQL Server 2025 running locally with a **non-default host port**:
> - Host: `localhost`
> - Host Port: `1434`
> - Container Port: `1433`
> - Container Name: `sql2025`
> - Auth: `sa` / `Password1!` (dev-only; not sensitive)
> - Image: `mcr.microsoft.com/mssql/server:2025-latest`
>
> Confirmed port publishing from `docker inspect`:
> - `1433/tcp` â†’ `0.0.0.0:1434` (also `:: :1434`)
>
> ## Non-negotiable requirement
> - **No SQLite anywhere**. Do not reintroduce any SQLite code paths, dependencies, or â€œfallbackâ€ logic.
> - SQL Server is the **only** supported backend going forward.
>
> ## What to do in this PR
>
> ### 1) Discover current ingestion/runners implementation
> Search the repo for the current/previous SQLite-based pieces and the runner entrypoints:
> - state store / work queue / â€œwork itemsâ€
> - wookieepedia (Wikipedia/Wikimedia) crawler (link discovery / cascading links / spawning additional links)
> - openalex ingestion
> - any â€œbidirectional synchronizerâ€ that syncs JSON artifacts to a DB
> - any config files that still reference â€œdb pathâ€, â€œsqlite fileâ€, â€œ.dbâ€, â€œsqlite:///â€, etc.
>
> Produce a short internal map in the PR description (or a new `docs/` note) of:
> - main modules/packages involved
> - how the runner loads work items and persists results today (even if broken)
>
> ### 2) Add/standardize SQL Server connection configuration
> Implement a single canonical DB configuration mechanism (env-first), and refactor all runners to use it.
>
> Required env vars (defaults for local dev):
> - `SQLSERVER_HOST=localhost`
> - `SQLSERVER_PORT=1434`
> - `SQLSERVER_USER=sa`
> - `SQLSERVER_PASSWORD=Password1!`
> - `SQLSERVER_DATABASE=Holocron` (or whatever this repoâ€™s canonical DB name isâ€”discover it; do not invent a new one)
> - `SQLSERVER_ENCRYPT=optional` (or equivalent; local docker commonly requires `TrustServerCertificate` behavior)
>
> Provide a helper to build the connection string for the Python driver you choose (pyodbc recommended if already used in repo; otherwise use the simplest existing pattern in this codebase).
>
> ### 3) Rewire the ingestion tables / queue tables to SQL Server 2025
> We expect the ingestion schema to include tables similar to:
> - `ingest.ingest_runs`
> - `ingest.ingest_records`
> - `ingest.scene_resources`
> - `ingest.work_items`
>
> Tasks:
> - **Confirm** the actual schema/table names in the repo (migrations, DDL, docs, or existing SQL scripts).
> - Ensure the Python runner reads from and writes to these tables in SQL Server.
> - Prioritize getting **work_items** processing functional again (Wikipedia crawling).
>
> If DDL/migrations do not exist or are incomplete:
> - Add a minimal SQL Server DDL script under `sql/` (or existing location) to create the required objects.
> - Keep it aligned with existing naming conventions.
>
> ### 4) Restore functionality: Wikipedia crawler + JSON â†’ SQL sync
> We have existing JSON artifacts from prior runs. We do NOT need to re-crawl from scratch.
>
> Implement (or re-enable) a mechanism that can:
> - Load/link-seed work items for Wikipedia pages
> - Crawl/fetch page JSON responses (including HTML and raw content if present)
> - Persist results to SQL Server tables (ingest_records / scene_resources / etc.)
> - Optionally â€œsync from JSONâ€ (bidirectional sync) that reads existing JSON files and inserts/upserts into SQL Server
>
> Guidance:
> - Keep source types generic (Wikipedia is priority; OpenAlex second; others can follow same pattern).
> - Do not overfit to one source; use a `source_type` or similar if already present.
>
> ### 5) Update runtime docs + local dev entrypoints
> - Update README/dev docs to reflect SQL Server 2025 @ `localhost,1434`
> - Add a `.env.example` (or equivalent) showing the SQL Server 2025 defaults above
> - Provide at least one â€œsmoke testâ€ command to verify DB connectivity from Python (e.g., select 1; list work_items count)
>
> ### 6) Testing / Verification
> At minimum:
> - Add a simple CLI smoke test command or script that:
>   - connects to SQL Server 2025 at `localhost:1434`
>   - queries `ingest.work_items` (or confirms table exists)
> - Ensure repository imports run without SQLite dependencies.
>
> ## Constraints / Guardrails
> - Breaking changes are acceptable; prioritize correctness and â€œSQL Server onlyâ€ direction.
> - Do not re-add SQLite as an option.
> - Use the existing repoâ€™s canonical DB name and schema patterns (discover, donâ€™t guess).
> - Keep secrets out of git; password here is dev-only but still should live in env vars, not comm...

</details>



<!-- START COPILOT CODING AGENT TIPS -->
---

ðŸ’¡ You can make Copilot smarter by setting up custom instructions, customizing its development environment and configuring Model Context Protocol (MCP) servers. Learn more [Copilot coding agent tips](https://gh.io/copilot-coding-agent-tips) in the docs.

---

## Comments

_No comments._

---

## Review Comments (inline diff)

_No inline review comments._

---

## Copilot Artifacts

_No Copilot artifact indicators detected._
